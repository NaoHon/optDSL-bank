#?o?M???O?Ìï¿½ï¿½???


#?g?p???C?u????
library(dplyr)
library(rpart)
library(pROC)
library(ggplot2)

##?f?[?^????
#???x?ï¿½ï¿½ï¿½ï¿½????Ì‚Åƒz?[???h?A?E?g?@?É‚????\?z?f?[?^?ÆŒ??f?[?^?É•?????
#?f?[?^?Ç?
train<-read.csv("C:/study/bank/motodata/train.csv", header=TRUE)

#?\?z?f?[?^?ÌŠ???
rate<-0.7

#?\?z?f?[?^??(?????ÌØÌ‚?)
num<-as.integer(nrow(train)*rate)

########?????_???É\?z?f?[?^???æ“¾########
#?ÄŒ????Ì‚??ß—????V?[?h???Å’?
set.seed(17)

#sample(?x?N?g??, ?????_???Éæ“¾?????Â?, ???????o?Ì—L??)
row<-sample(1:nrow(train), num, replace=FALSE)

#?\?z?f?[?^
train_train<-train[row,]

#???f?[?^
train_test<- train[-row,]

##???r?p?É•??Ê‚É\?z
#?????Øì¬
tree_tmp<-rpart(y~., data=dplyr::select(train_train, -id),
                maxdepth=10, minbucket=12, cp=0.000008,
                method="class", parms=list(split="gini"))

#???f?[?^?Ö“??Ä‚Í‚?
pred_test<-predict(tree_tmp, dplyr::select(train_test, -id, -y))[,2]

#AUC?ÌŒv?Z
#roc(?Ú“I?Ï?(1 or 0), ?\??????)
auc<-roc(train_test$y, pred_test)
print(auc)


##?o?M???O?Ìï¿½ï¿½?
#?????Í‘S?ÄŒ?????(rpart)???g?p

#???f???\?z????
L<-10

#rate_M*(train_train?Ìs??)?Ì??????f?[?^?ğ•œŒ????o
rate_M<-0.1
M<-as.integer(nrow(train_train)*rate_M)

#?ÄŒ????Ì‚??ß—????V?[?h???Å’?
set.seed(17)

#?o?M???O(???f???Í‘S?ÄŒ?????)
auc<-NULL
tree_tmp<-as.list(NULL)
for(i in 1:L){
  
  #sample(?x?N?g??, ?????_???Éæ“¾?????Â?, ???????o?Ì—L??)
  row<-sample(1:nrow(train_train), M, replace=TRUE)
  
  #???????o?É‚????\?z?f?[?^
  train_tmp<-train_train[row,]
  
  #?????Øì¬
  tree_tmp<-rpart(y~., data=dplyr::select(train_tmp, -id),
                  maxdepth=10, minbucket=12, cp=0.000008,
                  method="class", parms=list(split="gini"))
  
  #???f?[?^?Ö“??Ä‚Í‚?
  pred_test<-predict(tree_tmp, dplyr::select(train_test, -id, -y))[,2]
  
  #AUC?ÌŒv?Z
  #roc(?Ú“I?Ï?(1 or 0), ?\??????)
  auc_tmp<-roc(train_test$y, pred_test)
  auc <- c(auc, as.numeric(auc_tmp$auc))
  
  #?\?????Ê‚??Æ‚ï¿½ï¿½Ä‚???
{
    if(i==1){score_tmp<-pred_test}
    else{score_tmp<-data.frame(score_tmp, pred_test)}
  }

}

#?\?????Ê‚Ì•???
#apply(?f?[?^, 1, ?Ö?)?Åƒf?[?^???s???Æ‚É‰??x?N?g???Æ‚??ÄŠÖ??É“K?p
score<-apply(score_tmp, 1, mean)

#AUC?ÌŒv?Z
#roc(?Ú“I?Ï?(1 or 0), ?\??????)
auc_tmp<-roc(train_test$y, score)
auc <- c(auc, as.numeric(auc_tmp$auc))

#???Ê‚ÌŠm?F
model<-c(as.character(1:L),"ALL_mean")
dat<-data.frame(model, AUC=auc)

print(dat)

g<-ggplot(dat, aes(x=model, y=AUC)) + geom_bar(stat="identity")
plot(g)
